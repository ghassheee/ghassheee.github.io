---
title: Arch Linux OS
layout: dep
date: 2000-01-02
---






# Make an Installation USB Media

~~~sh
sudo diskutil list                              ## lsblk @Linux
sudo dd if=arch.img of=/dev/rdiskx bs=100m      ## change 'x' of /dev/rdiskx
~~~


# Boot the Installation USB Media

1. Insert USB and POWER ON.
2. PRESS F2 (or other keys) to enter BIOS.
3. confirm UEFI mode and Boot Order, then SAVE&EXIT (F10).

# Precondition

~~~sh
## loadkeys jp106                               ## IF JP Keyboard

wifi-menu                                       ## connect Wifi

ls /sys/firmware/efi/efivars                    ## see if efi-variables exist
# ls /sys/firmware/                             ## see if efi exists
~~~

# Minimal Installation

~~~sh
lsblk                                           ## Find Install Destination Device
DISK="/dev/sdx"                                 ## Maybe /dev/sda or /dev/sdb


gdisk /dev/$DISK                                ## Partitioning
##      o => y =>                               ## '=>' denotes 'Enter key'
##      n => => => +512M => ef00 =>             ## UEFI: ef00
##      n => => => +16G  => 8200 =>             ## SWAP: 8200
##      n => => =>       =>      =>             ## Default: 8300
##      w => y =>


mkfs.fat -F32   ${DISK}1
mkswap          ${DISK}2 && swapon ${DISK}2
mkfs.btrfs -f   ${DISK}3                        ## OPTION [ mkfs.xfs mkfs.ext4 ]


mount ${DISK}3 /mnt
mkdir /mnt/boot && mount ${DISK}1 /mnt/boot


timedatectl set-ntp true                        ## set systemclock


vim /etc/pacman.d/mirrorlist                    ## choose Mirror Server


pacstrap /mnt base base-devel


genfstab -U -p /mnt >> /mnt/etc/fstab           ## -p excludes pseudofs mounts


arch-chroot /mnt /bin/bash


pacman -S vim tmux zsh curl wget git openssh


zsh


YOURHOSTNAME="ghasshee"


echo "en_US.UTF-8 UTF-8" >> /etc/locale.gen
echo "ja_JP.UTF-8 UTF-8" >> /etc/locale.gen
echo "ru_RU.UTF-8 UTF-8" >> /etc/locale.gen
locale-gen


echo LANG=en_US.UTF-8 > /etc/locale.conf


ln -sf /usr/share/zoneinfo/Asia/Tokyo /etc/localtime
hwclock --systohc --utc


echo $YOURHOSTNAME > /etc/hostname


echo "127.0.0.1 localhost"  >> /etc/hosts


pacman -S btrfs-progs                           ## IF(BTRFS(a file system))

##

mkinitcpio -p linux


passwd                                          ## Root Password


pacman -S grub dosfstools efibootmgr
grub-install --target=x86_64-efi --efi-directory=/boot --bootloader-id=arch_grub --recheck --debug
mkdir /boot/EFI/boot && cp /boot/EFI/arch_grub/grubx64.efi /boot/EFI/boot/bootx64.efi
grub-mkconfig -o /boot/grub/grub.cfg


pacman -S networkmanager                        ## IF(wifi)
systemctl enable NetworkManager


exit
reboot                                          ## remove install media

#########################################

## IF(WIFI)
nmcli dev wifi connect $WIFINAME password $WIFIPASSWORD

## IF(LAN cable)
## systemctl enable dhcpcd.service && systemctl start dhcpcd.service
## systemctl enable netctl && systemctl start netctl
~~~


# Hibernate / Deep Sleep

Hibernate is a shutdown before which stores memory state into some swap region and shutdown.
The next wakeup will resume the machine state precisely.

~~~sh
## add this to kernel parameter `resume=/dev/sda2` thruough grub
sudo vim /etc/default/grub
#--vim
GRUB_CMDLINE_LINUX_DEFAULT="quiet splash resume=/dev/sda2"
#--vim :wq!
grub-mkconfig -o /boot/grub/grub.cfg    ## Regenerate grub

## then edit /etc/mkinitcpio.conf to add 'resume'
sudo vim /etc/mkinitcpio.conf
#--vim
HOOKS=(base udev autodetect keyboard modconf block filesystems resume fsck)
#--vim :wq
mkinitcpio -p linux
~~~



# Kernel Compilation


## Prerequisity

~~~sh
sudo pacman -S base-devel
sudo pacman -S xmlto docbook-xsl  ## recommend
~~~

## Download Kernel Src

~~~sh
mkdir ~/kernelbuild
cd ~/kernelbuild
wget https://www.kernel.org/pub/linux/kernel/v4.x/linux-4.8.6.tar.xz
tar -xvJf linux-4.8.6.tar.xz
cd linux-4.8.6/
make clean && make mrproper
~~~


## Configuration

~~~sh
pwd                 ## ~/kernelbuild/linux-4.8.6
zcat /proc/config.gz > .config
## ensure that all devices are connected
make localmodconfig

## Advanced Configuration
# make menuconfig   ## commandLine ncurses interface
# make nconfig      ## Newer ncurses interface
# make xconfig      ## User-friendly graphical interface that requires packageki-qt4
# make gconfig      ## Graphical configuration similar to xconfig using gtk
# lspci -k            ## (from LiveCD) lists names of kernel modules in use
~~~

## Compile the kernel

~~~sh
make
~~~


## Compile Modules

~~~sh
sudo make modules_install
~~~


## Copy the kernel to /boot dir

~~~sh
## 32 bit (i686) kernel
sudo cp -v arch/x86/boot/bzImage /boot/vmlinux-linux48

## 64 bit (x86_64) kernel
sudo cp -v arch/x86_64/boot/bzImage /boot/vmlinux-linux48
~~~


## Make Initial RAM disk

~~~sh
sudo cp /etc/mkinitcpio.d/linux.preset /etc/mkinitcpio.d/linux48.preset
sudo vim /etc/mkinitcpio.d/linux48.preset
---
ALL_kver="/boot/vmlinuz-linux48"
default_image="/boot/initramfs-linux48.img"
fallback_image="/boot/initramfs-linux48-fallback.img"
--- :wq!
mkinitcpio -p linux48
~~~


or
~~~sh
mkinitcpio -k linux-4.8.6 -g /boot/initramfs-linux48.img
~~~
